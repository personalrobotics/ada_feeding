<root BTCPP_format="4" main_tree_to_execute="PlateLocator" >
  <!-- Subtree Includes -->
  <include path="./helpers.xml" />

  <!-- Moving robot to locate plate -->
  <BehaviorTree ID="PlateLocator">
    <Sequence name="root_sequence">
      
      <RetryUntilSuccessful name="WaitForAlert" num_attempts="-1">
        <Sequence name="alert_sequence">
          <RosSubBool topic="/from_web_alert" target="{alert}" />
          <RosSubString topic="/from_web_movement" target="{locate}" />
          <Fallback>
            <Precondition if="{locate}==Forward" else="FAILURE">
              <Sequence>
                <!-- Go to forward: -10 cm-->
                <AdaPlanToOffset offset="0.00;-0.10;0.0" worldCollision="true" traj="{traj}" />
                <AdaExecuteTrajectory traj="{traj}" />
              </Sequence>
            </Precondition>
            <Precondition if="{locate}==Backward" else="FAILURE">
              <Sequence>
                <!-- Go to forward: -10 cm-->
                <AdaPlanToOffset offset="0.00;0.10;0.0" worldCollision="true" traj="{traj}" />
                <AdaExecuteTrajectory traj="{traj}" />
              </Sequence>
            </Precondition>
            <Precondition elseif="{locate}==Left" else="FAILURE">
              <Sequence>        
                <!-- Go to left: 10 cm -->
                <AdaPlanToOffset offset="0.10;0.00;0.0" worldCollision="true" traj="{traj}" />
                <AdaExecuteTrajectory traj="{traj}" />
              </Sequence>
            </Precondition>
            <Precondition elseif="{locate}==Right" else="FAILURE">
              <Sequence> 
                <!-- Go to right: 10 cm -->
                <AdaPlanToOffset offset="-0.10;0.00;0.0" worldCollision="true" traj="{traj}" />
                <AdaExecuteTrajectory traj="{traj}" />
              </Sequence>
            </Precondition> 
          </Fallback>
          <FAILURE _skipIf="alert==True"/>
        </Sequence>
      </RetryUntilSuccessful>

      <RetryUntilSuccessful name="WaitForOffset" num_attempts="-1">
        <Sequence name="offset_sequence">
          <RosSubVecD topic="/from_web_offset" target="{offset}" />
          <AdaPlanToOffset offset="{offset}" worldCollision="true" traj="{traj}" />
          <AdaExecuteTrajectory traj="{traj}" />
          <FAILURE _skipIf="offset==None" />
        </Sequence>
      </RetryUntilSuccessful>

    </Sequence>
  </BehaviorTree>
</root>
