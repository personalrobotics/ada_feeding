<root main_tree_to_execute = "Root" >
  <!-- Subtree Includes -->

  <!-- Watchdog -->
  <BehaviorTree ID="Root">
    <ReactiveSequence>
      <CheckWatchdog />
      <SubTree ID="Meal"/>
    </ReactiveSequence>
  </BehaviorTree>

  <!-- Main Meal Sequence -->
  <BehaviorTree ID="Meal">
    <Sequence name="MealSeq">
      <!-- Scripting constants -->
      <Script code=" TRUE:=true " />
      <Script code=" FALSE:=false " />

      <!-- Setup Workspace -->
      <SubTree ID="ParamToWorld" obj_name="wheelchair" /> 
      <SubTree ID="ParamToWorld" obj_name="table" /> 
      <SubTree ID="ParamToWorld" obj_name="plate" />

      <!-- Setup ADA -->
      <RosGetVecD param="velocityLimits/standard" target="{vel_standard}" />
      <AdaSetLimits velocity="{vel_standard}" />

      <Talk say="Hello! My name is Ayduh, it's a pleasure to serve you today!" />

      <!-- Bite Sequence -->
      <Repeat num_cycles="-1">
      <Sequence name="BiteSeq">

        <!-- Failure Just Restarts -->
        <Sequence name="FeedBite"> 

          <!-- Move in Front of Person -->
          <RosGetVecD param="configs/wheelchair/in_front_person" target="{config}" />
          <SubTree ID="MoveToConfig" config="{config}" worldCollision="{TRUE}" />

          <SwitchControllerBiteTransfer/>
          <RosSubBool topic="transfer_over" target="{transfer_over}" />

        </Sequence>
      </Sequence>
      </Repeat>
    </Sequence>
  </BehaviorTree>

  <!-- Pull from Param Server and add to World -->
  <BehaviorTree ID="ParamToWorld">
    <Sequence name="ParamToWorldSeq">
      <Script code=" urdfParam:='workspace/'+obj_name+'/urdf' " />
      <RosGetString param="{urdfParam}" target="{urdf}" />

      <Script code=" posParam:='workspace/'+obj_name+'/pos' " />
      <RosGetVecD param="{posParam}" target="{pos}" />

      <Script code=" quatParam:='workspace/'+obj_name+'/quat' " />
      <RosGetVecD param="{quatParam}" target="{quat}" />
      <WorldAddUpdate urdfUri="{urdf}" pos="{pos}" quat="{quat}" name="{obj_name}" />
    </Sequence>
  </BehaviorTree>

  <!-- Movement Trees -->
  <BehaviorTree ID="MoveToConfig">
    <Sequence name="MoveToConfigSeq">
      <AdaPlanToConfig config="{config}" worldCollision="{worldCollision}" traj="{traj}" />
      <AdaExecuteTrajectory traj="{traj}" />
    </Sequence>
  </BehaviorTree>
  <BehaviorTree ID="MoveToOffset">
    <Sequence name="MoveToOffsetSeq">
      <AdaPlanToOffset offset="{offset}" worldCollision="{worldCollision}" traj="{traj}" />
      <AdaExecuteTrajectory traj="{traj}" />
    </Sequence>
  </BehaviorTree>
  <BehaviorTree ID="MoveToPose">
    <Sequence name="MoveToPoseSeq">
      <AdaPlanToPose orig_pos="{orig_pos}" orig_quat="{orig_quat}"
         pos="{pos}" quat="{quat}" bounds="{bounds}" worldCollision="{worldCollision}" traj="{traj}" />
      <AdaExecuteTrajectory traj="{traj}" />
    </Sequence>
  </BehaviorTree>

</root>